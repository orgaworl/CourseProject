# SM3实现
### 算法原理
SM3为MD结构Hash函数,对长度小于$2^{64}$比特的消息m，SM3杂凑算法经过填充和迭代压缩，生成杂凑值，杂凑值长度
为256比特

- 填充  
  假设消息m 的长度为l比特。首先将比特“1”添加到消息的末尾，再添加k 个“0”，k是满
足l + 1 + k ≡ 448mod512 的最小的非负整数。然后再添加一个64位比特串，该比特串是长度l的二进
制表示。填充后的消息$m^{\prime}$的比特长度为512的倍数。
- 迭代压缩  
将填充后的消息  $m^{\prime}$  按 512 比特进行分组: $m^{\prime}=B^{(0)} B^{(1)} \cdots B^{(n-1)}$  
其中$n=(l+k+65) / 512$.  
对 $m^{\prime}$ 按下列方式迭代: 
$\\ FOR\ \ i=0 \ TO\ \ n-1 \\
\ \ \ \ \ V^{(i+1)}=C F\left(V^{(i)}, B^{(i)}\right)\\
ENDFOR$  
其中CF是压僱函数,  $V^{(0)}$  为 256 比特初始值IV, $B^{(i)}$ 为填充后的消息分组, 迭代压维的结果为$V^{(n)}$.

ps: x86架构CPU程序为小端模式,而算法原版默认为大端模式,要对实现进行适当修改.


### 正确性验证
![正确性](.\\picture\\prove.png)
![正确性](.\\picture\\prove2.png)


### 实现优化
- 循环展开.减少循环次数,增加每次循环计算量.
- 减少过程调用,尤其是在内层循环中.
- 使用中间变量保存计算中间值,减少数据依赖,提高运算并行度.
- 减少访存频率,尽可能使用变量进行运算.


### 实现效率测试
**测试平台**
| 配置    | 参数 |
| ----------- | ----------- |
| CPU         | INTEL CORE i5-11300H 3.1GHz 4核8线程       |
| Memory|DDR4 3200Hz 16GB     |
|OS|Windows10      |
| IDE|VS2019      |
| Language|C++     |

**测试结果**
